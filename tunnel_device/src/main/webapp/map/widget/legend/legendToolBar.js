if(void 0===G_Dci_Info)var G_Dci_Info={};require(["dojo/_base/declare","dojo/query","dojo/_base/lang","dojo/_base/array","dojo/_base/html","dojo/on","dojo/topic","esri/layers/layer","esri/layers/LayerInfo","esri/layers/FeatureLayer","esri/dijit/Legend"],function(e,n,i,a,d,r,t,l,o,s,g){G_Dci_Info.legendToolBar={map:null,legend:null,initLegend:function(e){this.map=e,this.creatElement()},creatElement:function(){var e=new StringBuffer;e.append("<div id='divLegend'>"),e.append("<div class='legendTitle'><img class='icon_layer' src='./images/widget/legend/legend.png'><label>图例</label> <div id='hideLegend' class='closeLayer'></div></div>"),e.append("<div id='map_Legend' class='mapLegend'></div>"),e.append("<div>"),$("#map").append(e.toString()),n("#hideLegend").on("click",i.hitch(this,function(){$("#divLegend").hide(500)})),this.legend=new g({map:this.map,autoUpdate:!0,layerInfos:this.getLegendLayerInfo(),arrangement:esri.dijit.Legend.ALIGN_LEFT},"map_Legend"),this.legend.startup(),t.subscribe("manualRefreshLegend",i.hitch(this,function(){this.legend.refresh(this.getLegendLayerInfo())}))},getLegendLayerInfo:function(){var a=[],e=$.fn.zTree.getZTreeObj("treeLayer");if(e){var n=e.getCheckedNodes(!0);$.each(n,function(e,n){if("Layer"==n.iconType){var i=new s(n.url);a.push({layer:i,title:"▤ "+n.lable})}})}return a}}});