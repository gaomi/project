if(void 0===G_Dci_Info)var G_Dci_Info={};require(["dojo/_base/declare","dojo/query","dojo/_base/lang","dojo/_base/array","dojo/_base/html","dojo/on","esri/layers/layer","esri/layers/LayerInfo","dojo/topic"],function(e,i,n,r,a,l,o,s,t){G_Dci_Info.LayerListToolBar={map:null,initLayerList:function(e){this.map=e,this.creatElement()},creatElement:function(){var e=new StringBuffer;e.append("<div id='divLayerList'>"),e.append("<div class='layerListTitle'><img src='./images/widget/layerList/layerList.png' class='icon_layer'><label>图层管理</label> <div id='hideTreeLayer' class='closeLayer'></div></div>"),e.append("<div class='layerListLine'></div>"),e.append("<div class='divLayerTree'>"),e.append("<ul id='treeLayer' class='ztree'></ul>"),e.append("</div>"),e.append("<div>"),$("#map").append(e.toString()),i("#hideTreeLayer").on("click",n.hitch(this,function(){$("#divLayerList").hide(500)})),this.initLayerTreeLoad()},initLayerTreeLoad:function(){var e={view:{showLine:!1},check:{enable:!0},data:{key:{name:"lable",checked:"visible",children:"childNodeCol",url:""},simpleData:{enable:!0}},callback:{onCheck:function(e,i,n){n&&(function(e){"Folder"==e.iconType?function(n){var e=[];e=o(e,n,"Server"),$.each(e,function(e,i){i.visible=n.visible,r(i)})}(e):"Server"==e.iconType?r(e):"Group"==e.iconType?function(e){var i=l(e),n=G_Dci_Info.LayerListToolBar.map.getLayer(i.id),a=n.visibleLayers;null!=a&&1==a.length&&-1==a[0]&&(a=[]);var r=[];r=o(r,e,"Layer"),e.visible?($.each(r,function(e,i){var n=i.url.substr(i.url.lastIndexOf("/")+1);-1==a.indexOf(n)&&a.push(n)}),n.visible||n.setVisibility(!0)):($.each(r,function(e,i){var r=i.url.substr(i.url.lastIndexOf("/")+1);a.forEach(function(e,i,n){e==r&&n.splice(i,1)})}),0==a.length&&(n.visible&&n.setVisibility(!1),a=[-1])),n.setVisibleLayers(a)}(e):function(e){var i=l(e),n=G_Dci_Info.LayerListToolBar.map.getLayer(i.id),r=n.visibleLayers;null!=r&&1==r.length&&-1==r[0]&&(r=[]);var a=e.url.substr(e.url.lastIndexOf("/")+1);e.visible?(-1==r.indexOf(a)&&r.push(a),n.visible||n.setVisibility(!0)):(r.forEach(function(e,i,n){e==a&&n.splice(i,1)}),0==r.length&&(n.visible&&n.setVisibility(!1),r=[-1])),n.setVisibleLayers(r)}(e)}(n),t.publish("manualRefreshLegend"))},onClick:function(e,i,n,r){n.open?$.fn.zTree.getZTreeObj("treeLayer").expandNode(n,!1,!0):$.fn.zTree.getZTreeObj("treeLayer").expandNode(n,!0,!0)}}};function r(e){var i=G_Dci_Info.LayerListToolBar.map.getLayer(e.id);if(e.visible){i.layerInfos;var n=[];n=o(n,e,"Layer");var r=[];$.each(n,function(e,i){var n=i.url.substr(i.url.lastIndexOf("/")+1);-1==r.indexOf(n)&&r.push(n)}),i.setVisibleLayers(r),i.setVisibility(e.visible)}else i.setVisibleLayers([-1]),i.setVisibility(e.visible)}function l(e){var i=e.getParentNode();return null!=i&&"Server"!=i.iconType&&(i=l(i)),i}function o(e,i,n){if(i.iconType==n&&e.push(i),i.isParent)for(var r in i.childNodeCol)o(e,i.childNodeCol[r],n);return e}if(MapConfig.layerListCol){var i=MapConfig.layerListCol;!function n(e){"object"==typeof e&&$.each(e,function(e,i){"Folder"==i.iconType?i.iconSkin="icon_Folder":"Server"==i.iconType?i.iconSkin="icon_Server":"Group"==i.iconType?i.iconSkin="icon_Group":"Layer"==i.iconType&&("point"==i.layerFlag?i.iconSkin="icon_Layer_Point":"line"==i.layerFlag?i.iconSkin="icon_Layer_Line":"polygon"==i.layerFlag?i.iconSkin="icon_Layer_Polygon":i.iconSkin="icon_Layer"),i.childNodeCol&&0<i.childNodeCol.length&&n(i.childNodeCol)})}(i),$.fn.zTree.init($("#treeLayer"),e,i)}}}});