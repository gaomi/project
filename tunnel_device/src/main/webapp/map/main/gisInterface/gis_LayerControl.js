define(["dojo/_base/declare","dojo/_base/array","dojo/_base/html","dojo/on","esri/map","esri/layers/layer","esri/layers/LayerInfo","dojo/topic"],function(e,r,i,a,s,l,n,t){return e("Gis_LayerControl",null,{_map:null,constructor:function(e){_map=e},setLayerVisible:function(e){try{var l=$.fn.zTree.getZTreeObj("treeLayer");$.each(e,function(e,r){if(null!=r.serverId&&0<r.serverId.length){var i=_map.getLayer(r.serverId),a=l.getNodeByParam("id",r.serverId);if(i&&a){if(r.visible){var s=i.visibleLayers;null!=s&&1==s.length&&-1==s[0]&&(s=[]),null!=r.showLayerId&&0<r.showLayerId.length&&$.each(r.showLayerId,function(e,r){var i=l.getNodeByParam("id",r);if(i){var a=i.url.substr(i.url.lastIndexOf("/")+1);-1==s.indexOf(a)&&s.push(a),l.checkNode(i,!0,!0)}}),null!=r.hideLayerId&&0<r.hideLayerId.length&&$.each(r.hideLayerId,function(e,r){var i=l.getNodeByParam("id",r);if(i){var a=i.url.substr(i.url.lastIndexOf("/")+1);s.forEach(function(e,r,i){e==a&&i.splice(r,1)}),l.checkNode(i,!1,!0)}}),i.setVisibility(r.visible),i.setVisibleLayers(s)}else i.setVisibility(r.visible),i.setVisibleLayers([-1]),l.checkNode(a,r.visible,!0);l.expandNode(a,r.visible,!0)}}}),t.publish("manualRefreshLegend")}catch(e){tipDialog("图层控制发生异常!",3,!1)}}})});